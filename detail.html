<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Detail Produk - Simo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <script type="module">
        import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";
        window.supabase = createClient(
            "https://rophyuhutaervefifkoo.supabase.co",
            "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJvcGh5dWh1dGFlcnZlZmlma29vIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE1MTU1OTUsImV4cCI6MjA2NzA5MTU5NX0.GLQiYABXO5JkoLQ30nOeuM4RvmHJ8juYj-SI_SxknWQ"
        );
    </script>

</head>

<body class="bg-gray-50">

    <!-- Navigation -->
    <header class="bg-white shadow-sm sticky top-0 z-50">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <a href="index.html" class="text-2xl font-bold text-indigo-600">
                <span class="text-indigo-800">Si</span>mo
            </a>
            <nav class="hidden md:flex space-x-6">
                <a href="index.html" class="text-gray-600 hover:text-indigo-600 font-medium">Beranda</a>
                <a href="products.html" class="text-gray-600 hover:text-indigo-600 font-medium">Produk</a>
                <a href="about.html" class="text-gray-600 hover:text-indigo-600 font-medium">Tentang Kami</a>
                <a href="contact.html" class="text-gray-600 hover:text-indigo-600 font-medium">Kontak</a>
            </nav>

            <!-- Mobile Menu -->
            <div id="mobile-menu"
                class="md:hidden hidden flex-col space-y-2 mt-4 bg-white px-4 py-2 shadow-md absolute right-4 top-16 rounded z-50">
                <a href="index.html" class="text-gray-600 hover:text-indigo-600 font-medium">Beranda</a>
                <a href="products.html" class="text-gray-600 hover:text-indigo-600 font-medium">Produk</a>
                <a href="about.html" class="text-gray-600 hover:text-indigo-600 font-medium">Tentang Kami</a>
                <a href="contact.html" class="text-gray-600 hover:text-indigo-600 font-medium">Kontak</a>
            </div>

            <!-- Ikon kanan -->
            <div class="flex items-center space-x-4">
                <!-- Ikon Sosial -->
                <a href="https://www.instagram.com/simpelmodern.id?igsh=MTA0eTUyNXNqNXZwZw==" target="_blank"
                    class="text-gray-600 hover:text-indigo-600">
                    <i class="fab fa-instagram"></i>
                </a>
                <a href="https://www.tiktok.com/@simostore.id?is_from_webapp=1&sender_device=pc" target="_blank"
                    class="text-gray-600 hover:text-indigo-600">
                    <i class="fab fa-tiktok"></i>
                </a>
                <!-- <a href="https://shopee.co.id/simo" target="_blank" class="text-gray-600 hover:text-indigo-600">
                    <i class="fas fa-shopping-basket"></i>

                </a>
                <a href="https://tokopedia.com/simo" target="_blank" class="text-gray-600 hover:text-indigo-600">
                    <i class="fas fa-shopping-bag"></i>
                </a>
                <a href="https://facebook.com/simo" target="_blank" class="text-gray-600 hover:text-indigo-600">
                    <i class="fab fa-facebook-f"></i>
                </a> -->

                <!-- Tombol Search -->
                <div class="relative">
                    <button id="search-btn" class="text-gray-600 hover:text-indigo-600">
                        <i class="fas fa-search"></i>
                    </button>

                    <!-- Form Pencarian (awal tersembunyi) -->
                    <div id="search-box"
                        class="hidden absolute right-0 mt-2 w-64 bg-white border border-gray-300 rounded shadow-lg p-2">
                        <input id="search-input" type="text" placeholder="Cari produk..."
                            class="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-indigo-600">
                        <button onclick="handleSearch()"
                            class="mt-2 w-full bg-indigo-600 text-white py-2 rounded hover:bg-indigo-700">Cari</button>
                    </div>
                </div>


                <!-- Keranjang -->
                <a href="cart.html" class="text-gray-600 hover:text-indigo-600 relative">
                    <i class="fas fa-shopping-cart"></i>
                    <span id="cart-count"
                        class="absolute -top-2 -right-2 bg-indigo-600 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center">0</span>
                </a>

                <!-- Toggle mobile menu -->
                <button class="md:hidden text-gray-600 hover:text-indigo-600">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
        </div>
    </header>

    <!-- Produk Section -->
    <section class="py-12 px-4 max-w-6xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-10">
        <!-- Gambar -->
        <div class="relative">
            <div id="carousel-images" class="overflow-hidden rounded-lg shadow-md">
                <div class="flex transition-transform duration-500" id="carousel-track">
                    <!-- Gambar akan ditambahkan dengan JS -->
                </div>
            </div>
            <!-- Tombol -->
            <button onclick="prevImage()"
                class="absolute left-0 top-1/2 -translate-y-1/2 bg-black/40 text-white px-3 py-2 rounded-r hover:bg-black">&lt;</button>
            <button onclick="nextImage()"
                class="absolute right-0 top-1/2 -translate-y-1/2 bg-black/40 text-white px-3 py-2 rounded-l hover:bg-black">&gt;</button>
        </div>

        <!-- Info -->
        <div class="bg-white p-6 rounded-lg shadow flex flex-col justify-between h-full">

            <h1 id="product-name" class="text-2xl font-bold mb-3">Loading...</h1>
            <div class="flex items-center gap-4 mb-2">
                <p id="product-price" class="text-indigo-600 font-semibold text-lg"></p>
                <p id="product-oldprice" class="text-sm text-gray-400 line-through"></p>
            </div>

            <label for="product-size" class="block text-sm mb-1">Pilih Ukuran:</label>
            <select id="product-size" class="w-full border rounded px-3 py-2 mb-4">
                <option value="">-- Pilih Size --</option>
                <option value="S">S</option>
                <option value="M">M</option>
                <option value="L">L</option>
                <option value="XL">XL</option>
            </select>

            <p id="product-desc" class="text-gray-700 text-sm mb-4"></p>

            <button id="add-to-cart"
                class="bg-indigo-600 text-white py-2 w-full rounded hover:bg-indigo-700 font-semibold">Tambah ke
                Keranjang</button>
        </div>
    </section>



    <!-- Komentar & Rating -->
    <section class="max-w-4xl mx-auto px-4 mb-24">
        <h2 class="text-lg font-bold mb-4 text-gray-800">Ulasan Produk</h2>

        <!-- Form -->
        <div class="bg-white p-4 rounded shadow-sm mb-6">
            <div class="flex items-center mb-2">
                <span class="mr-3 text-sm text-gray-700">Beri Rating:</span>
                <div id="star-rating" class="flex space-x-1 text-xl text-gray-400 cursor-pointer">
                    <i class="fas fa-star" data-rate="1"></i>
                    <i class="fas fa-star" data-rate="2"></i>
                    <i class="fas fa-star" data-rate="3"></i>
                    <i class="fas fa-star" data-rate="4"></i>
                    <i class="fas fa-star" data-rate="5"></i>
                </div>
            </div>
            <textarea id="comment-input" rows="3"
                class="w-full border rounded px-3 py-2 text-sm focus:outline-none focus:ring focus:border-indigo-500"
                placeholder="Tulis komentar Anda..."></textarea>
            <button id="submit-comment"
                class="mt-3 bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded text-sm">Kirim
                Komentar</button>
        </div>

        <!-- Daftar Komentar -->
        <div id="comment-list" class="space-y-4">
            <!-- Akan diisi oleh JS -->
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-12">
        <div class="container mx-auto px-4">
            <div class="grid md:grid-cols-4 gap-8">
                <div>
                    <h3 class="text-xl font-bold mb-4">Simo</h3>
                    <p class="text-gray-400">Toko Pakaian premium dengan kualitas terbaik dengan harga terjangkau.</p>
                </div>
                <div>
                    <h4 class="font-semibold mb-4">Tautan Cepat</h4>
                    <ul class="space-y-2">
                        <li><a href="index.html" class="text-gray-400 hover:text-white">Beranda</a></li>
                        <li><a href="products.html" class="text-gray-400 hover:text-white">Produk</a></li>
                        <li><a href="about.html" class="text-gray-400 hover:text-white">Tentang Kami</a></li>
                        <li><a href="contact.html" class="text-gray-400 hover:text-white">Kontak</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-semibold mb-4">Bantuan</h4>
                    <ul class="space-y-2">
                        <li><a href="#" class="text-gray-400 hover:text-white">Panduan Ukuran</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white">Kebijakan Pengembalian</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white">Metode Pembayaran</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white">FAQ</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-semibold mb-4">Hubungi Kami</h4>
                    <ul class="space-y-2 mb-4">
                        <li class="text-gray-400"><i class="fas fa-phone-alt mr-2"></i> +62 831 4401 1224</li>
                        <li class="text-gray-400"><i class="fas fa-envelope mr-2"></i> simo@gmail.com</li>
                        <li class="text-gray-400"><i class="fas fa-map-marker-alt mr-2"></i> Bandung, Indonesia</li>
                    </ul>
                    <div class="flex space-x-4 mt-2">
                        <a href="https://www.tiktok.com/@simostore.id?is_from_webapp=1&sender_device=pc" target="_blank"
                            class="text-gray-400 hover:text-white text-xl">
                            <i class="fab fa-tiktok"></i>
                        </a>
                        <a href="https://www.instagram.com/simpelmodern.id?igsh=MTA0eTUyNXNqNXZwZw==" target="_blank"
                            class="text-gray-400 hover:text-white text-xl">
                            <i class="fab fa-instagram"></i>
                        </a>
                        <!-- <a href="#" target="_blank"
                            class="text-gray-400 hover:text-white text-xl">
                            <i class="fab fa-facebook-f"></i>
                        </a>
                        <a href="#" target="_blank"
                            class="text-gray-400 hover:text-white text-xl">
                            <i class="fas fa-store"></i>
                        </a>
                        <a href="#" target="_blank"
                            class="text-gray-400 hover:text-white text-xl">
                            <i class="fas fa-shopping-bag"></i>
                        </a> -->
                    </div>
                </div>
            </div>
            <div class="border-t border-gray-700 mt-8 pt-8 text-center text-gray-400">
                <p>&copy; 2025 Simo. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Dummy Produk -->
    <script src="product.js"></script>

    <!-- Script Fungsional -->
    <script>
        let currentSlide = 0;
        let selectedRating = 0;

        const params = new URLSearchParams(window.location.search);
        const id = parseInt(params.get("id") || "1");
        const product = products.find(p => p.id === id) || products[0];

        async function saveComment(productId, comment) {
            const { error } = await supabase.from("comments").insert([
                {
                    product_id: productId,
                    rating: comment.rating,
                    text: comment.text,
                },
            ]);
            if (error) {
                console.error("Gagal menyimpan komentar:", error);
                alert("Gagal menyimpan komentar.");
            }
        }

        async function loadComments(productId) {
            const { data, error } = await supabase
                .from("comments")
                .select("*")
                .eq("product_id", productId)
                .order("created_at", { ascending: false });

            if (error) {
                console.error("Gagal mengambil komentar:", error);
                return [];
            }

            return data;
        }

        async function renderComments(productId) {
            const container = document.getElementById("comment-list");
            container.innerHTML = "";
            const comments = await loadComments(productId); // ← PENTING pakai await
            if (comments.length === 0) {
                container.innerHTML = "<p class='text-gray-500 text-sm'>Belum ada ulasan.</p>";
                return;
            }

            comments.forEach(c => {
                container.innerHTML += `
                <div class="bg-white border rounded p-4">
                    <div class="flex items-center text-yellow-400 mb-1 text-sm">
                        ${'★'.repeat(c.rating)}${'☆'.repeat(5 - c.rating)}
                    </div>
                    <p class="text-gray-700 text-sm">${c.text}</p>
                </div>
            `;
            });
        }

        // Tambah ke keranjang
        function addToCart(product, size) {
            const cart = JSON.parse(localStorage.getItem("cart") || "[]");
            const index = cart.findIndex(item => item.id === product.id && item.size === size);

            if (index !== -1) {
                cart[index].qty += 1;
            } else {
                cart.push({
                    id: product.id,
                    name: product.name,
                    price: product.price,
                    image: product.images[0],
                    size: size,
                    qty: 1
                });
            }

            localStorage.setItem("cart", JSON.stringify(cart));
            document.getElementById("cart-count").textContent = cart.reduce((acc, item) => acc + item.qty, 0);
        }


        document.addEventListener("DOMContentLoaded", async () => {
            // Isi produk
            document.getElementById("product-name").textContent = product.name;
            document.getElementById("product-price").textContent = `Rp ${product.price.toLocaleString("id-ID")}`;
            document.getElementById("product-desc").textContent = product.desc;
            if (product.originalPrice) {
                document.getElementById("product-oldprice").textContent = `Rp ${product.originalPrice.toLocaleString("id-ID")}`;
            } else {
                document.getElementById("product-oldprice").style.display = "none";
            }

            // Carousel
            const track = document.getElementById("carousel-track");
            product.images.forEach(src => {
                const img = document.createElement("img");
                img.src = src;
                img.className = "w-full h-[400px] object-cover flex-shrink-0";
                track.appendChild(img);
            });
            showSlide(currentSlide);



            // Tombol tambah ke keranjang
            document.getElementById("add-to-cart").addEventListener("click", () => {
                const size = document.getElementById("product-size").value;
                if (!size) return alert("Silakan pilih ukuran.");
                addToCart(product, size);
                alert("Produk ditambahkan ke keranjang.");
            });

            const cart = JSON.parse(localStorage.getItem("cart") || "[]");
            document.getElementById("cart-count").textContent = cart.reduce((acc, item) => acc + item.qty, 0);



            // Pilih rating
            document.querySelectorAll("#star-rating i").forEach(star => {
                star.addEventListener("click", () => {
                    selectedRating = parseInt(star.dataset.rate);
                    document.querySelectorAll("#star-rating i").forEach(s => {
                        const rate = parseInt(s.dataset.rate);
                        s.classList.toggle("text-yellow-400", rate <= selectedRating);
                        s.classList.toggle("text-gray-400", rate > selectedRating);
                    });
                });
            });

            // Kirim komentar
            document.getElementById("submit-comment").addEventListener("click", async () => {
                const text = document.getElementById("comment-input").value.trim();
                if (!selectedRating || !text) return alert("Isi rating dan komentar.");

                await saveComment(id, { rating: selectedRating, text });
                document.getElementById("comment-input").value = "";
                selectedRating = 0;
                document.querySelectorAll("#star-rating i").forEach(s => s.classList.remove("text-yellow-400"));
                await renderComments(id);
            });

            // Tampilkan komentar awal
            await renderComments(id);
        });

        function showSlide(index) {
            const track = document.getElementById("carousel-track");
            track.style.transform = `translateX(-${index * 100}%)`;
        }

        function nextImage() {
            const total = document.querySelectorAll("#carousel-track img").length;
            currentSlide = (currentSlide + 1) % total;
            showSlide(currentSlide);
        }

        function prevImage() {
            const total = document.querySelectorAll("#carousel-track img").length;
            currentSlide = (currentSlide - 1 + total) % total;
            showSlide(currentSlide);
        }
    </script>

</body>

</html>